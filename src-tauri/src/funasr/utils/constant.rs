use crate::funasr::utils::{WavFrontend, CMVN};
use ndarray::{Array1, Array2};
use std::clone::Clone;
use std::f32::consts::PI;
use std::sync::LazyLock;

// 采样频率
pub const SAMPLE_RATE: usize = 16000;
// 每帧的长度，单位：ms
pub const FRAME_LENGTH_MS: usize = 25;
// 每帧的偏移，单位：ms
pub const FRAME_SHIFT_MS: usize = 10;
// 每帧的长度，单位：样本点
pub const FRAME_LENGTH: usize = SAMPLE_RATE * FRAME_LENGTH_MS / 1000;
// 每帧的偏移，单位：样本点
pub const FRAME_SHIFT: usize = SAMPLE_RATE * FRAME_SHIFT_MS / 1000;
// 梅尔滤波器数量
pub const MEL_BINS: usize = 80;
/// 最低频率 (Hz)，滤波器组覆盖的最低频率 通常设为 20Hz 以忽略极低频噪声
pub const LOW_FREQ: f32 = 20.0;
/// 最高频率 (Hz) 通常为 fs/2
pub const HIGH_FREQ: f32 = 8000.0;
/// 预加重系数，用于平衡高频和低频能量
pub const PREEMPH_COEFF: f32 = 0.97f32;
/// 噪声增益 0.00003f32
pub const NOISE_GAIN: f32 = 0.00003f32;
/// 将 FRAME_LENGTH 向上舍入到最近的2的幂次方
pub const PADDED_SIZE: usize = round_up_to_nearest_power_of_two(FRAME_LENGTH);
/// 创建梅尔滤波器组系数矩阵
pub static MEL_BANKS: LazyLock<Array2<f32>> = LazyLock::new(|| create_mel_banks());
/// 汉明窗
pub static HAMMING_WINDOW: LazyLock<Array1<f32>> = LazyLock::new(|| hamming_window());
/// 并行处理的线程数
pub const INTRA_THREADS: usize = 4;
/// 语音识别 LFR_M LFR_N
pub const SPEECH_RECOGNITION_LFR_M: usize = 7;
pub const SPEECH_RECOGNITION_LFR_N: usize = 6;
/// 端点检测 LFR_M LFR_N
pub static ENDPOINT_DETECTION_LFR_M: usize = 5;
pub static ENDPOINT_DETECTION_LFR_N: usize = 1;
/// 语音端点检测 窗口检测器相关参数
pub const WIN_SIZE_FRAME: usize = 20; // 滑动窗口大小，单位为帧数
pub const SIL_TO_SPEECH_FRMCNT_THRES: usize = 15; // 静音到语音帧数阈值
pub const SPEECH_TO_SIL_FRMCNT_THRES: usize = 15; // 语音到静音帧数阈值

/// 将整数向上舍入到最近的2的幂次方
const fn round_up_to_nearest_power_of_two(mut n: usize) -> usize {
    if n <= 1 {
        return 1;
    }
    n -= 1;
    n |= n >> 1; // 填充最高位右边的1位
    n |= n >> 2; // 填充最高位右边的2位
    n |= n >> 4; // 填充最高位右边的4位
    n |= n >> 8; // 填充最高位右边的8位
    n |= n >> 16; // 填充最高位右边的16位 (对于64位系统需要再加 >> 32)
    n + 1
}

/// 创建梅尔滤波器组系数矩阵
fn create_mel_banks() -> Array2<f32> {
    /// 将频率（Hz）转换为梅尔频率
    fn hz_to_mel(hz: f32) -> f32 {
        1127.0 * (1.0 + hz / 700.0).ln()
    }

    /// 将梅尔频率转换为频率（Hz）
    fn mel_to_hz(mel: f32) -> f32 {
        700.0 * ((mel / 1127.0).exp() - 1.0)
    }

    // FFT 后的频谱点数（取一半，因为对称性）
    let n_fft = PADDED_SIZE / 2 + 1;

    // 将频率转换为梅尔频率
    let low_mel = hz_to_mel(LOW_FREQ);
    let high_mel = hz_to_mel(HIGH_FREQ);

    // 在梅尔频率上均匀分布 n_mels + 2 个点
    let mel_points = Array1::linspace(low_mel, high_mel, MEL_BINS + 2);

    // 将梅尔频率转换回赫兹频率
    let hz_points = mel_points.map(|&mel| mel_to_hz(mel));

    // 将赫兹频率转换为 FFT bin 索引
    let bin_points = hz_points.map(|&hz| hz * PADDED_SIZE as f32 / SAMPLE_RATE as f32);

    // 创建梅尔滤波器组矩阵
    let mut mel_banks = Array2::zeros((MEL_BINS, n_fft));

    for m in 0..MEL_BINS {
        let left = bin_points[m];
        let center = bin_points[m + 1];
        let right = bin_points[m + 2];
        // 确保索引在有效范围内
        if center >= n_fft as f32 {
            continue;
        }
        for j in 0..n_fft {
            mel_banks[[m, j]] = if j as f32 >= left && j as f32 <= center {
                if center > left {
                    (j as f32 - left) / (center - left)
                } else {
                    0.0
                }
            } else if j as f32 > center && j as f32 <= right {
                if right > center {
                    (right - j as f32) / (right - center)
                } else {
                    0.0
                }
            } else {
                0.0
            };
        }
    }
    mel_banks
}

/// 获取hamming窗
fn hamming_window() -> Array1<f32> {
    let mut window = Array1::range(0.0, FRAME_LENGTH as f32, 1.0);
    window.mapv_inplace(|x| 0.54 - 0.46 * (2.0 * PI * x / (FRAME_LENGTH as f32 - 1.0)).cos());
    window
}

pub(crate) static ENDPOINT_DETECTION_CMVN: LazyLock<CMVN> = LazyLock::new(|| CMVN {
    means: vec![
        -8.311879, -8.600912, -9.615928, -10.43595, -11.21292, -11.88333, -12.36243, -12.63706,
        -12.8818, -12.83066, -12.89103, -12.95666, -13.19763, -13.40598, -13.49113, -13.5546,
        -13.55639, -13.51915, -13.68284, -13.53289, -13.42107, -13.65519, -13.50713, -13.75251,
        -13.76715, -13.87408, -13.73109, -13.70412, -13.56073, -13.53488, -13.54895, -13.56228,
        -13.59408, -13.62047, -13.64198, -13.66109, -13.62669, -13.58297, -13.57387, -13.4739,
        -13.53063, -13.48348, -13.61047, -13.64716, -13.71546, -13.79184, -13.90614, -14.03098,
        -14.18205, -14.35881, -14.48419, -14.60172, -14.70591, -14.83362, -14.92122, -15.00622,
        -15.05122, -15.03119, -14.99028, -14.92302, -14.86927, -14.82691, -14.7972, -14.76909,
        -14.71356, -14.61277, -14.51696, -14.42252, -14.36405, -14.30451, -14.23161, -14.19851,
        -14.16633, -14.15649, -14.10504, -13.99518, -13.79562, -13.3996, -12.7767, -11.71208,
        -8.311879, -8.600912, -9.615928, -10.43595, -11.21292, -11.88333, -12.36243, -12.63706,
        -12.8818, -12.83066, -12.89103, -12.95666, -13.19763, -13.40598, -13.49113, -13.5546,
        -13.55639, -13.51915, -13.68284, -13.53289, -13.42107, -13.65519, -13.50713, -13.75251,
        -13.76715, -13.87408, -13.73109, -13.70412, -13.56073, -13.53488, -13.54895, -13.56228,
        -13.59408, -13.62047, -13.64198, -13.66109, -13.62669, -13.58297, -13.57387, -13.4739,
        -13.53063, -13.48348, -13.61047, -13.64716, -13.71546, -13.79184, -13.90614, -14.03098,
        -14.18205, -14.35881, -14.48419, -14.60172, -14.70591, -14.83362, -14.92122, -15.00622,
        -15.05122, -15.03119, -14.99028, -14.92302, -14.86927, -14.82691, -14.7972, -14.76909,
        -14.71356, -14.61277, -14.51696, -14.42252, -14.36405, -14.30451, -14.23161, -14.19851,
        -14.16633, -14.15649, -14.10504, -13.99518, -13.79562, -13.3996, -12.7767, -11.71208,
        -8.311879, -8.600912, -9.615928, -10.43595, -11.21292, -11.88333, -12.36243, -12.63706,
        -12.8818, -12.83066, -12.89103, -12.95666, -13.19763, -13.40598, -13.49113, -13.5546,
        -13.55639, -13.51915, -13.68284, -13.53289, -13.42107, -13.65519, -13.50713, -13.75251,
        -13.76715, -13.87408, -13.73109, -13.70412, -13.56073, -13.53488, -13.54895, -13.56228,
        -13.59408, -13.62047, -13.64198, -13.66109, -13.62669, -13.58297, -13.57387, -13.4739,
        -13.53063, -13.48348, -13.61047, -13.64716, -13.71546, -13.79184, -13.90614, -14.03098,
        -14.18205, -14.35881, -14.48419, -14.60172, -14.70591, -14.83362, -14.92122, -15.00622,
        -15.05122, -15.03119, -14.99028, -14.92302, -14.86927, -14.82691, -14.7972, -14.76909,
        -14.71356, -14.61277, -14.51696, -14.42252, -14.36405, -14.30451, -14.23161, -14.19851,
        -14.16633, -14.15649, -14.10504, -13.99518, -13.79562, -13.3996, -12.7767, -11.71208,
        -8.311879, -8.600912, -9.615928, -10.43595, -11.21292, -11.88333, -12.36243, -12.63706,
        -12.8818, -12.83066, -12.89103, -12.95666, -13.19763, -13.40598, -13.49113, -13.5546,
        -13.55639, -13.51915, -13.68284, -13.53289, -13.42107, -13.65519, -13.50713, -13.75251,
        -13.76715, -13.87408, -13.73109, -13.70412, -13.56073, -13.53488, -13.54895, -13.56228,
        -13.59408, -13.62047, -13.64198, -13.66109, -13.62669, -13.58297, -13.57387, -13.4739,
        -13.53063, -13.48348, -13.61047, -13.64716, -13.71546, -13.79184, -13.90614, -14.03098,
        -14.18205, -14.35881, -14.48419, -14.60172, -14.70591, -14.83362, -14.92122, -15.00622,
        -15.05122, -15.03119, -14.99028, -14.92302, -14.86927, -14.82691, -14.7972, -14.76909,
        -14.71356, -14.61277, -14.51696, -14.42252, -14.36405, -14.30451, -14.23161, -14.19851,
        -14.16633, -14.15649, -14.10504, -13.99518, -13.79562, -13.3996, -12.7767, -11.71208,
        -8.311879, -8.600912, -9.615928, -10.43595, -11.21292, -11.88333, -12.36243, -12.63706,
        -12.8818, -12.83066, -12.89103, -12.95666, -13.19763, -13.40598, -13.49113, -13.5546,
        -13.55639, -13.51915, -13.68284, -13.53289, -13.42107, -13.65519, -13.50713, -13.75251,
        -13.76715, -13.87408, -13.73109, -13.70412, -13.56073, -13.53488, -13.54895, -13.56228,
        -13.59408, -13.62047, -13.64198, -13.66109, -13.62669, -13.58297, -13.57387, -13.4739,
        -13.53063, -13.48348, -13.61047, -13.64716, -13.71546, -13.79184, -13.90614, -14.03098,
        -14.18205, -14.35881, -14.48419, -14.60172, -14.70591, -14.83362, -14.92122, -15.00622,
        -15.05122, -15.03119, -14.99028, -14.92302, -14.86927, -14.82691, -14.7972, -14.76909,
        -14.71356, -14.61277, -14.51696, -14.42252, -14.36405, -14.30451, -14.23161, -14.19851,
        -14.16633, -14.15649, -14.10504, -13.99518, -13.79562, -13.3996, -12.7767, -11.71208,
    ],
    vars: vec![
        0.155775, 0.154484, 0.1527379, 0.1518718, 0.1506028, 0.1489256, 0.147067, 0.1447061,
        0.1436307, 0.1443568, 0.1451849, 0.1455157, 0.1452821, 0.1445717, 0.1439195, 0.1435867,
        0.1436018, 0.1438781, 0.1442086, 0.1448844, 0.1454756, 0.145663, 0.146268, 0.1467386,
        0.1472724, 0.147664, 0.1480913, 0.1483739, 0.1488841, 0.1493636, 0.1497088, 0.1500379,
        0.1502916, 0.1505389, 0.1506787, 0.1507102, 0.1505992, 0.1505445, 0.1505938, 0.1508133,
        0.1509569, 0.1512396, 0.1514625, 0.1516195, 0.1516156, 0.1515561, 0.1514966, 0.1513976,
        0.1512612, 0.151076, 0.1510596, 0.1510431, 0.151077, 0.1511168, 0.1511917, 0.151023,
        0.1508045, 0.1505885, 0.1503493, 0.1502373, 0.1501726, 0.1500762, 0.1500065, 0.1499782,
        0.150057, 0.1502658, 0.150469, 0.1505335, 0.1505505, 0.1505328, 0.1504275, 0.1502438,
        0.1499674, 0.1497118, 0.1494661, 0.1493102, 0.1493681, 0.1495501, 0.1499738, 0.1509654,
        0.155775, 0.154484, 0.1527379, 0.1518718, 0.1506028, 0.1489256, 0.147067, 0.1447061,
        0.1436307, 0.1443568, 0.1451849, 0.1455157, 0.1452821, 0.1445717, 0.1439195, 0.1435867,
        0.1436018, 0.1438781, 0.1442086, 0.1448844, 0.1454756, 0.145663, 0.146268, 0.1467386,
        0.1472724, 0.147664, 0.1480913, 0.1483739, 0.1488841, 0.1493636, 0.1497088, 0.1500379,
        0.1502916, 0.1505389, 0.1506787, 0.1507102, 0.1505992, 0.1505445, 0.1505938, 0.1508133,
        0.1509569, 0.1512396, 0.1514625, 0.1516195, 0.1516156, 0.1515561, 0.1514966, 0.1513976,
        0.1512612, 0.151076, 0.1510596, 0.1510431, 0.151077, 0.1511168, 0.1511917, 0.151023,
        0.1508045, 0.1505885, 0.1503493, 0.1502373, 0.1501726, 0.1500762, 0.1500065, 0.1499782,
        0.150057, 0.1502658, 0.150469, 0.1505335, 0.1505505, 0.1505328, 0.1504275, 0.1502438,
        0.1499674, 0.1497118, 0.1494661, 0.1493102, 0.1493681, 0.1495501, 0.1499738, 0.1509654,
        0.155775, 0.154484, 0.1527379, 0.1518718, 0.1506028, 0.1489256, 0.147067, 0.1447061,
        0.1436307, 0.1443568, 0.1451849, 0.1455157, 0.1452821, 0.1445717, 0.1439195, 0.1435867,
        0.1436018, 0.1438781, 0.1442086, 0.1448844, 0.1454756, 0.145663, 0.146268, 0.1467386,
        0.1472724, 0.147664, 0.1480913, 0.1483739, 0.1488841, 0.1493636, 0.1497088, 0.1500379,
        0.1502916, 0.1505389, 0.1506787, 0.1507102, 0.1505992, 0.1505445, 0.1505938, 0.1508133,
        0.1509569, 0.1512396, 0.1514625, 0.1516195, 0.1516156, 0.1515561, 0.1514966, 0.1513976,
        0.1512612, 0.151076, 0.1510596, 0.1510431, 0.151077, 0.1511168, 0.1511917, 0.151023,
        0.1508045, 0.1505885, 0.1503493, 0.1502373, 0.1501726, 0.1500762, 0.1500065, 0.1499782,
        0.150057, 0.1502658, 0.150469, 0.1505335, 0.1505505, 0.1505328, 0.1504275, 0.1502438,
        0.1499674, 0.1497118, 0.1494661, 0.1493102, 0.1493681, 0.1495501, 0.1499738, 0.1509654,
        0.155775, 0.154484, 0.1527379, 0.1518718, 0.1506028, 0.1489256, 0.147067, 0.1447061,
        0.1436307, 0.1443568, 0.1451849, 0.1455157, 0.1452821, 0.1445717, 0.1439195, 0.1435867,
        0.1436018, 0.1438781, 0.1442086, 0.1448844, 0.1454756, 0.145663, 0.146268, 0.1467386,
        0.1472724, 0.147664, 0.1480913, 0.1483739, 0.1488841, 0.1493636, 0.1497088, 0.1500379,
        0.1502916, 0.1505389, 0.1506787, 0.1507102, 0.1505992, 0.1505445, 0.1505938, 0.1508133,
        0.1509569, 0.1512396, 0.1514625, 0.1516195, 0.1516156, 0.1515561, 0.1514966, 0.1513976,
        0.1512612, 0.151076, 0.1510596, 0.1510431, 0.151077, 0.1511168, 0.1511917, 0.151023,
        0.1508045, 0.1505885, 0.1503493, 0.1502373, 0.1501726, 0.1500762, 0.1500065, 0.1499782,
        0.150057, 0.1502658, 0.150469, 0.1505335, 0.1505505, 0.1505328, 0.1504275, 0.1502438,
        0.1499674, 0.1497118, 0.1494661, 0.1493102, 0.1493681, 0.1495501, 0.1499738, 0.1509654,
        0.155775, 0.154484, 0.1527379, 0.1518718, 0.1506028, 0.1489256, 0.147067, 0.1447061,
        0.1436307, 0.1443568, 0.1451849, 0.1455157, 0.1452821, 0.1445717, 0.1439195, 0.1435867,
        0.1436018, 0.1438781, 0.1442086, 0.1448844, 0.1454756, 0.145663, 0.146268, 0.1467386,
        0.1472724, 0.147664, 0.1480913, 0.1483739, 0.1488841, 0.1493636, 0.1497088, 0.1500379,
        0.1502916, 0.1505389, 0.1506787, 0.1507102, 0.1505992, 0.1505445, 0.1505938, 0.1508133,
        0.1509569, 0.1512396, 0.1514625, 0.1516195, 0.1516156, 0.1515561, 0.1514966, 0.1513976,
        0.1512612, 0.151076, 0.1510596, 0.1510431, 0.151077, 0.1511168, 0.1511917, 0.151023,
        0.1508045, 0.1505885, 0.1503493, 0.1502373, 0.1501726, 0.1500762, 0.1500065, 0.1499782,
        0.150057, 0.1502658, 0.150469, 0.1505335, 0.1505505, 0.1505328, 0.1504275, 0.1502438,
        0.1499674, 0.1497118, 0.1494661, 0.1493102, 0.1493681, 0.1495501, 0.1499738, 0.1509654,
    ],
});

pub(crate) static SPEECH_RECOGNITION_CMVN: LazyLock<CMVN> = LazyLock::new(|| CMVN {
    means: vec![
        -8.311879, -8.600912, -9.615928, -10.43595, -11.21292, -11.88333, -12.36243, -12.63706,
        -12.8818, -12.83066, -12.89103, -12.95666, -13.19763, -13.40598, -13.49113, -13.5546,
        -13.55639, -13.51915, -13.68284, -13.53289, -13.42107, -13.65519, -13.50713, -13.75251,
        -13.76715, -13.87408, -13.73109, -13.70412, -13.56073, -13.53488, -13.54895, -13.56228,
        -13.59408, -13.62047, -13.64198, -13.66109, -13.62669, -13.58297, -13.57387, -13.4739,
        -13.53063, -13.48348, -13.61047, -13.64716, -13.71546, -13.79184, -13.90614, -14.03098,
        -14.18205, -14.35881, -14.48419, -14.60172, -14.70591, -14.83362, -14.92122, -15.00622,
        -15.05122, -15.03119, -14.99028, -14.92302, -14.86927, -14.82691, -14.7972, -14.76909,
        -14.71356, -14.61277, -14.51696, -14.42252, -14.36405, -14.30451, -14.23161, -14.19851,
        -14.16633, -14.15649, -14.10504, -13.99518, -13.79562, -13.3996, -12.7767, -11.71208,
        -8.311879, -8.600912, -9.615928, -10.43595, -11.21292, -11.88333, -12.36243, -12.63706,
        -12.8818, -12.83066, -12.89103, -12.95666, -13.19763, -13.40598, -13.49113, -13.5546,
        -13.55639, -13.51915, -13.68284, -13.53289, -13.42107, -13.65519, -13.50713, -13.75251,
        -13.76715, -13.87408, -13.73109, -13.70412, -13.56073, -13.53488, -13.54895, -13.56228,
        -13.59408, -13.62047, -13.64198, -13.66109, -13.62669, -13.58297, -13.57387, -13.4739,
        -13.53063, -13.48348, -13.61047, -13.64716, -13.71546, -13.79184, -13.90614, -14.03098,
        -14.18205, -14.35881, -14.48419, -14.60172, -14.70591, -14.83362, -14.92122, -15.00622,
        -15.05122, -15.03119, -14.99028, -14.92302, -14.86927, -14.82691, -14.7972, -14.76909,
        -14.71356, -14.61277, -14.51696, -14.42252, -14.36405, -14.30451, -14.23161, -14.19851,
        -14.16633, -14.15649, -14.10504, -13.99518, -13.79562, -13.3996, -12.7767, -11.71208,
        -8.311879, -8.600912, -9.615928, -10.43595, -11.21292, -11.88333, -12.36243, -12.63706,
        -12.8818, -12.83066, -12.89103, -12.95666, -13.19763, -13.40598, -13.49113, -13.5546,
        -13.55639, -13.51915, -13.68284, -13.53289, -13.42107, -13.65519, -13.50713, -13.75251,
        -13.76715, -13.87408, -13.73109, -13.70412, -13.56073, -13.53488, -13.54895, -13.56228,
        -13.59408, -13.62047, -13.64198, -13.66109, -13.62669, -13.58297, -13.57387, -13.4739,
        -13.53063, -13.48348, -13.61047, -13.64716, -13.71546, -13.79184, -13.90614, -14.03098,
        -14.18205, -14.35881, -14.48419, -14.60172, -14.70591, -14.83362, -14.92122, -15.00622,
        -15.05122, -15.03119, -14.99028, -14.92302, -14.86927, -14.82691, -14.7972, -14.76909,
        -14.71356, -14.61277, -14.51696, -14.42252, -14.36405, -14.30451, -14.23161, -14.19851,
        -14.16633, -14.15649, -14.10504, -13.99518, -13.79562, -13.3996, -12.7767, -11.71208,
        -8.311879, -8.600912, -9.615928, -10.43595, -11.21292, -11.88333, -12.36243, -12.63706,
        -12.8818, -12.83066, -12.89103, -12.95666, -13.19763, -13.40598, -13.49113, -13.5546,
        -13.55639, -13.51915, -13.68284, -13.53289, -13.42107, -13.65519, -13.50713, -13.75251,
        -13.76715, -13.87408, -13.73109, -13.70412, -13.56073, -13.53488, -13.54895, -13.56228,
        -13.59408, -13.62047, -13.64198, -13.66109, -13.62669, -13.58297, -13.57387, -13.4739,
        -13.53063, -13.48348, -13.61047, -13.64716, -13.71546, -13.79184, -13.90614, -14.03098,
        -14.18205, -14.35881, -14.48419, -14.60172, -14.70591, -14.83362, -14.92122, -15.00622,
        -15.05122, -15.03119, -14.99028, -14.92302, -14.86927, -14.82691, -14.7972, -14.76909,
        -14.71356, -14.61277, -14.51696, -14.42252, -14.36405, -14.30451, -14.23161, -14.19851,
        -14.16633, -14.15649, -14.10504, -13.99518, -13.79562, -13.3996, -12.7767, -11.71208,
        -8.311879, -8.600912, -9.615928, -10.43595, -11.21292, -11.88333, -12.36243, -12.63706,
        -12.8818, -12.83066, -12.89103, -12.95666, -13.19763, -13.40598, -13.49113, -13.5546,
        -13.55639, -13.51915, -13.68284, -13.53289, -13.42107, -13.65519, -13.50713, -13.75251,
        -13.76715, -13.87408, -13.73109, -13.70412, -13.56073, -13.53488, -13.54895, -13.56228,
        -13.59408, -13.62047, -13.64198, -13.66109, -13.62669, -13.58297, -13.57387, -13.4739,
        -13.53063, -13.48348, -13.61047, -13.64716, -13.71546, -13.79184, -13.90614, -14.03098,
        -14.18205, -14.35881, -14.48419, -14.60172, -14.70591, -14.83362, -14.92122, -15.00622,
        -15.05122, -15.03119, -14.99028, -14.92302, -14.86927, -14.82691, -14.7972, -14.76909,
        -14.71356, -14.61277, -14.51696, -14.42252, -14.36405, -14.30451, -14.23161, -14.19851,
        -14.16633, -14.15649, -14.10504, -13.99518, -13.79562, -13.3996, -12.7767, -11.71208,
        -8.311879, -8.600912, -9.615928, -10.43595, -11.21292, -11.88333, -12.36243, -12.63706,
        -12.8818, -12.83066, -12.89103, -12.95666, -13.19763, -13.40598, -13.49113, -13.5546,
        -13.55639, -13.51915, -13.68284, -13.53289, -13.42107, -13.65519, -13.50713, -13.75251,
        -13.76715, -13.87408, -13.73109, -13.70412, -13.56073, -13.53488, -13.54895, -13.56228,
        -13.59408, -13.62047, -13.64198, -13.66109, -13.62669, -13.58297, -13.57387, -13.4739,
        -13.53063, -13.48348, -13.61047, -13.64716, -13.71546, -13.79184, -13.90614, -14.03098,
        -14.18205, -14.35881, -14.48419, -14.60172, -14.70591, -14.83362, -14.92122, -15.00622,
        -15.05122, -15.03119, -14.99028, -14.92302, -14.86927, -14.82691, -14.7972, -14.76909,
        -14.71356, -14.61277, -14.51696, -14.42252, -14.36405, -14.30451, -14.23161, -14.19851,
        -14.16633, -14.15649, -14.10504, -13.99518, -13.79562, -13.3996, -12.7767, -11.71208,
        -8.311879, -8.600912, -9.615928, -10.43595, -11.21292, -11.88333, -12.36243, -12.63706,
        -12.8818, -12.83066, -12.89103, -12.95666, -13.19763, -13.40598, -13.49113, -13.5546,
        -13.55639, -13.51915, -13.68284, -13.53289, -13.42107, -13.65519, -13.50713, -13.75251,
        -13.76715, -13.87408, -13.73109, -13.70412, -13.56073, -13.53488, -13.54895, -13.56228,
        -13.59408, -13.62047, -13.64198, -13.66109, -13.62669, -13.58297, -13.57387, -13.4739,
        -13.53063, -13.48348, -13.61047, -13.64716, -13.71546, -13.79184, -13.90614, -14.03098,
        -14.18205, -14.35881, -14.48419, -14.60172, -14.70591, -14.83362, -14.92122, -15.00622,
        -15.05122, -15.03119, -14.99028, -14.92302, -14.86927, -14.82691, -14.7972, -14.76909,
        -14.71356, -14.61277, -14.51696, -14.42252, -14.36405, -14.30451, -14.23161, -14.19851,
        -14.16633, -14.15649, -14.10504, -13.99518, -13.79562, -13.3996, -12.7767, -11.71208,
    ],
    vars: vec![
        0.155775, 0.154484, 0.1527379, 0.1518718, 0.1506028, 0.1489256, 0.147067, 0.1447061,
        0.1436307, 0.1443568, 0.1451849, 0.1455157, 0.1452821, 0.1445717, 0.1439195, 0.1435867,
        0.1436018, 0.1438781, 0.1442086, 0.1448844, 0.1454756, 0.145663, 0.146268, 0.1467386,
        0.1472724, 0.147664, 0.1480913, 0.1483739, 0.1488841, 0.1493636, 0.1497088, 0.1500379,
        0.1502916, 0.1505389, 0.1506787, 0.1507102, 0.1505992, 0.1505445, 0.1505938, 0.1508133,
        0.1509569, 0.1512396, 0.1514625, 0.1516195, 0.1516156, 0.1515561, 0.1514966, 0.1513976,
        0.1512612, 0.151076, 0.1510596, 0.1510431, 0.151077, 0.1511168, 0.1511917, 0.151023,
        0.1508045, 0.1505885, 0.1503493, 0.1502373, 0.1501726, 0.1500762, 0.1500065, 0.1499782,
        0.150057, 0.1502658, 0.150469, 0.1505335, 0.1505505, 0.1505328, 0.1504275, 0.1502438,
        0.1499674, 0.1497118, 0.1494661, 0.1493102, 0.1493681, 0.1495501, 0.1499738, 0.1509654,
        0.155775, 0.154484, 0.1527379, 0.1518718, 0.1506028, 0.1489256, 0.147067, 0.1447061,
        0.1436307, 0.1443568, 0.1451849, 0.1455157, 0.1452821, 0.1445717, 0.1439195, 0.1435867,
        0.1436018, 0.1438781, 0.1442086, 0.1448844, 0.1454756, 0.145663, 0.146268, 0.1467386,
        0.1472724, 0.147664, 0.1480913, 0.1483739, 0.1488841, 0.1493636, 0.1497088, 0.1500379,
        0.1502916, 0.1505389, 0.1506787, 0.1507102, 0.1505992, 0.1505445, 0.1505938, 0.1508133,
        0.1509569, 0.1512396, 0.1514625, 0.1516195, 0.1516156, 0.1515561, 0.1514966, 0.1513976,
        0.1512612, 0.151076, 0.1510596, 0.1510431, 0.151077, 0.1511168, 0.1511917, 0.151023,
        0.1508045, 0.1505885, 0.1503493, 0.1502373, 0.1501726, 0.1500762, 0.1500065, 0.1499782,
        0.150057, 0.1502658, 0.150469, 0.1505335, 0.1505505, 0.1505328, 0.1504275, 0.1502438,
        0.1499674, 0.1497118, 0.1494661, 0.1493102, 0.1493681, 0.1495501, 0.1499738, 0.1509654,
        0.155775, 0.154484, 0.1527379, 0.1518718, 0.1506028, 0.1489256, 0.147067, 0.1447061,
        0.1436307, 0.1443568, 0.1451849, 0.1455157, 0.1452821, 0.1445717, 0.1439195, 0.1435867,
        0.1436018, 0.1438781, 0.1442086, 0.1448844, 0.1454756, 0.145663, 0.146268, 0.1467386,
        0.1472724, 0.147664, 0.1480913, 0.1483739, 0.1488841, 0.1493636, 0.1497088, 0.1500379,
        0.1502916, 0.1505389, 0.1506787, 0.1507102, 0.1505992, 0.1505445, 0.1505938, 0.1508133,
        0.1509569, 0.1512396, 0.1514625, 0.1516195, 0.1516156, 0.1515561, 0.1514966, 0.1513976,
        0.1512612, 0.151076, 0.1510596, 0.1510431, 0.151077, 0.1511168, 0.1511917, 0.151023,
        0.1508045, 0.1505885, 0.1503493, 0.1502373, 0.1501726, 0.1500762, 0.1500065, 0.1499782,
        0.150057, 0.1502658, 0.150469, 0.1505335, 0.1505505, 0.1505328, 0.1504275, 0.1502438,
        0.1499674, 0.1497118, 0.1494661, 0.1493102, 0.1493681, 0.1495501, 0.1499738, 0.1509654,
        0.155775, 0.154484, 0.1527379, 0.1518718, 0.1506028, 0.1489256, 0.147067, 0.1447061,
        0.1436307, 0.1443568, 0.1451849, 0.1455157, 0.1452821, 0.1445717, 0.1439195, 0.1435867,
        0.1436018, 0.1438781, 0.1442086, 0.1448844, 0.1454756, 0.145663, 0.146268, 0.1467386,
        0.1472724, 0.147664, 0.1480913, 0.1483739, 0.1488841, 0.1493636, 0.1497088, 0.1500379,
        0.1502916, 0.1505389, 0.1506787, 0.1507102, 0.1505992, 0.1505445, 0.1505938, 0.1508133,
        0.1509569, 0.1512396, 0.1514625, 0.1516195, 0.1516156, 0.1515561, 0.1514966, 0.1513976,
        0.1512612, 0.151076, 0.1510596, 0.1510431, 0.151077, 0.1511168, 0.1511917, 0.151023,
        0.1508045, 0.1505885, 0.1503493, 0.1502373, 0.1501726, 0.1500762, 0.1500065, 0.1499782,
        0.150057, 0.1502658, 0.150469, 0.1505335, 0.1505505, 0.1505328, 0.1504275, 0.1502438,
        0.1499674, 0.1497118, 0.1494661, 0.1493102, 0.1493681, 0.1495501, 0.1499738, 0.1509654,
        0.155775, 0.154484, 0.1527379, 0.1518718, 0.1506028, 0.1489256, 0.147067, 0.1447061,
        0.1436307, 0.1443568, 0.1451849, 0.1455157, 0.1452821, 0.1445717, 0.1439195, 0.1435867,
        0.1436018, 0.1438781, 0.1442086, 0.1448844, 0.1454756, 0.145663, 0.146268, 0.1467386,
        0.1472724, 0.147664, 0.1480913, 0.1483739, 0.1488841, 0.1493636, 0.1497088, 0.1500379,
        0.1502916, 0.1505389, 0.1506787, 0.1507102, 0.1505992, 0.1505445, 0.1505938, 0.1508133,
        0.1509569, 0.1512396, 0.1514625, 0.1516195, 0.1516156, 0.1515561, 0.1514966, 0.1513976,
        0.1512612, 0.151076, 0.1510596, 0.1510431, 0.151077, 0.1511168, 0.1511917, 0.151023,
        0.1508045, 0.1505885, 0.1503493, 0.1502373, 0.1501726, 0.1500762, 0.1500065, 0.1499782,
        0.150057, 0.1502658, 0.150469, 0.1505335, 0.1505505, 0.1505328, 0.1504275, 0.1502438,
        0.1499674, 0.1497118, 0.1494661, 0.1493102, 0.1493681, 0.1495501, 0.1499738, 0.1509654,
        0.155775, 0.154484, 0.1527379, 0.1518718, 0.1506028, 0.1489256, 0.147067, 0.1447061,
        0.1436307, 0.1443568, 0.1451849, 0.1455157, 0.1452821, 0.1445717, 0.1439195, 0.1435867,
        0.1436018, 0.1438781, 0.1442086, 0.1448844, 0.1454756, 0.145663, 0.146268, 0.1467386,
        0.1472724, 0.147664, 0.1480913, 0.1483739, 0.1488841, 0.1493636, 0.1497088, 0.1500379,
        0.1502916, 0.1505389, 0.1506787, 0.1507102, 0.1505992, 0.1505445, 0.1505938, 0.1508133,
        0.1509569, 0.1512396, 0.1514625, 0.1516195, 0.1516156, 0.1515561, 0.1514966, 0.1513976,
        0.1512612, 0.151076, 0.1510596, 0.1510431, 0.151077, 0.1511168, 0.1511917, 0.151023,
        0.1508045, 0.1505885, 0.1503493, 0.1502373, 0.1501726, 0.1500762, 0.1500065, 0.1499782,
        0.150057, 0.1502658, 0.150469, 0.1505335, 0.1505505, 0.1505328, 0.1504275, 0.1502438,
        0.1499674, 0.1497118, 0.1494661, 0.1493102, 0.1493681, 0.1495501, 0.1499738, 0.1509654,
        0.155775, 0.154484, 0.1527379, 0.1518718, 0.1506028, 0.1489256, 0.147067, 0.1447061,
        0.1436307, 0.1443568, 0.1451849, 0.1455157, 0.1452821, 0.1445717, 0.1439195, 0.1435867,
        0.1436018, 0.1438781, 0.1442086, 0.1448844, 0.1454756, 0.145663, 0.146268, 0.1467386,
        0.1472724, 0.147664, 0.1480913, 0.1483739, 0.1488841, 0.1493636, 0.1497088, 0.1500379,
        0.1502916, 0.1505389, 0.1506787, 0.1507102, 0.1505992, 0.1505445, 0.1505938, 0.1508133,
        0.1509569, 0.1512396, 0.1514625, 0.1516195, 0.1516156, 0.1515561, 0.1514966, 0.1513976,
        0.1512612, 0.151076, 0.1510596, 0.1510431, 0.151077, 0.1511168, 0.1511917, 0.151023,
        0.1508045, 0.1505885, 0.1503493, 0.1502373, 0.1501726, 0.1500762, 0.1500065, 0.1499782,
        0.150057, 0.1502658, 0.150469, 0.1505335, 0.1505505, 0.1505328, 0.1504275, 0.1502438,
        0.1499674, 0.1497118, 0.1494661, 0.1493102, 0.1493681, 0.1495501, 0.1499738, 0.1509654,
    ],
});

pub static SPEECH_RECOGNITION_WAV_FRONTEND: LazyLock<WavFrontend> = LazyLock::new(|| {
    WavFrontend::new(
        SPEECH_RECOGNITION_CMVN.clone(),
        SPEECH_RECOGNITION_LFR_M,
        SPEECH_RECOGNITION_LFR_N,
    )
});
pub static ENDPOINT_DETECTION_WAV_FRONTEND: LazyLock<WavFrontend> = LazyLock::new(|| {
    WavFrontend::new(
        ENDPOINT_DETECTION_CMVN.clone(),
        ENDPOINT_DETECTION_LFR_M,
        ENDPOINT_DETECTION_LFR_N,
    )
});
